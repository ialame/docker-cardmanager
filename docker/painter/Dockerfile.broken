#!/bin/bash

# ğŸ”§ Correction Rapide du Dockerfile Painter

echo "ğŸ”§ Correction du Dockerfile Painter"
echo "==================================="

echo ""
echo "âœ… BONNE NOUVELLE !"
echo "   Le build Painter a rÃ©ussi !"
echo "   Seule la commande COPY finale est incorrecte"
echo ""

# Sauvegarder le Dockerfile actuel
cp docker/painter/Dockerfile docker/painter/Dockerfile.backup-$(date +%Y%m%d_%H%M%S)
echo "ğŸ’¾ Dockerfile sauvegardÃ©"

echo ""
echo "ğŸ”§ Correction de la commande COPY..."

# Corriger la ligne COPY problÃ©matique
sed -i 's|COPY --from=builder /usr/src/app/painter/target/painter-\*.jar app.jar 2>/dev/null || COPY --from=builder /usr/src/app/painter/painter/target/painter-\*.jar app.jar 2>/dev/null || COPY --from=builder /usr/src/app/painter/\*/target/painter-\*.jar app.jar|COPY --from=builder /usr/src/app/painter/painter/target/painter-*.jar app.jar|' docker/painter/Dockerfile

echo "âœ… Dockerfile corrigÃ©"

echo ""
echo "ğŸ“‹ Ligne COPY corrigÃ©e :"
echo "   AVANT: COPY avec || (syntaxe invalide)"
echo "   APRÃˆS: COPY --from=builder /usr/src/app/painter/painter/target/painter-*.jar app.jar"

echo ""
echo "ğŸš€ Le build va maintenant fonctionner !"
echo "   ./build-with-ssh.sh"

echo ""
echo "ğŸ’¡ Si le JAR n'est pas trouvÃ© Ã  cet emplacement, voici les alternatives :"
echo "   1. /usr/src/app/painter/target/painter-*.jar"
echo "   2. /usr/src/app/painter/painter/target/painter-*.jar"
echo "   3. /usr/src/app/painter/*/target/painter-*.jar"
echo ""
echo "ğŸ” Nous utilisons l'emplacement le plus probable : painter/target/"
